# Effekseer

Effekseerは、ゲームエフェクトを作成するためのツールおよび、様々な環境で再生するためのミドルウェアです。  
オープンソースで開発されていて、世界中に多くのユーザーが居ます。

２０２２年１１月現在、私は次期バージョン「1.8」に向けての開発に参加しています。  

アセットの再利用性を高めるための「SubEffect（仮称）」機能の開発のコアメンバーとして設計や実装をしています。  

!!! info
    「SubEffect（仮称）」機能は、複数のエフェクトを組み合わせて、１つのエフェクトにすることができるようになる機能です。  
    UnityのNested Prefab（プレハブの中にプレハブを入れることが出来る機能）に似た機能になる予定です。

## 開発内容

今回の機能実装に伴い、シリアライズ方法やオブジェクトシステム、エディタ設計など、大規模な再構築することになりました。  
このため、以下のような取り組みをしています。

また、作業についてのログなどは、こちらのIssueにて随時更新しています。
ぜひご一読ください。  
（備考：私のGitHubユーザー名は「mewmew-tea」です。）
**[https://github.com/effekseer/Effekseer/issues/894](https://github.com/effekseer/Effekseer/issues/894)**

### ランタイム＆エディタ：シリアライズ形式の大幅変更

今回の新機能追加に合わせて、シリアライズ方式の大幅変更を計画しています。  
具体的には、FlatBuffersの採用を予定していて、より高速な読み書きを実現する予定です。  

また、**後方互換性を維持するための実装もします。**

### エディタ：Inspectorの作り替え

シリアライズ方式の変更に合わせて、エディタのパラメータ調整のためのInspector（旧名称：ParameterList）をすべて作り替えています。   
機能や見た目はそのまま維持しつつ、今後の機能拡張を行いやすくするためUnityのInspectorの実装を参考にしながら開発中です。   

- パラメータをリフレクションで解析してGUIを自動で構築する仕組み
- ノードオブジェクトの管理
- Undo/Redo

### 専用のテストの計画、開発

機能追加やシリアライズ方式の変更が正しく動作するか、テストの計画と開発をしています。  
新旧バージョンそれぞれで自動でスクリーンショットを撮影し、差異が無いかをチェックするテストです。  

- 300を超えるエフェクト素材を自動でDL、テストしやすい形式に整えるPythonスクリプト
- 上記のエフェクト素材をすべて再生、スクリーンショットを撮影（C++）
- Pythonスクリプトで新旧バージョンのスクリーンショットを比較（開発中）

このテストは、「後方互換性が正しく保たれているか？」も確認します。  
よって、４つの状態でスクリーンショットの撮影と比較をします。

- 旧形式のファイルを、旧バージョンで再生
- **^^新形式^^**のファイルを、 **^^新バージョン^^**で再生
- 旧形式のファイルを、新バージョンで再生
- **^^旧型式のファイルを新形式へ変換^^**、**^^新バージョン^^**で再生


